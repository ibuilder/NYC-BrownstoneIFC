<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New York Brownstone IFC Generator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls for Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <!-- web-ifc-three for IFC viewing -->
    <script src="https://unpkg.com/web-ifc-three@0.0.122/dist/web-ifc-three.js"></script>
    <!-- Custom styles -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 60px;
        }
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://www.mammothnewyork.com/hubfs/Blog%20Photos/NYC%20Brownstones/New%20York%20City%20brownstons%20with%20the%20modern%20architecture%20behind%20them.jpg');
            background-size: cover;
            color: white;
            padding: 100px 0;
            margin-bottom: 30px;
        }
        .section {
            padding: 60px 0;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        #viewer-container {
            width: 100%;
            height: 500px;
            background-color: #f5f5f5;
            position: relative;
        }
        .code-block {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .step-number {
            background-color: #6c757d;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        .feature-icon {
            font-size: 2rem;
            color: #0d6efd;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Brownstone IFC Generator</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#overview">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#scripts">Scripts</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#viewer">3D Viewer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#documentation">Documentation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#download">Download</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero text-center">
        <div class="container">
            <h1 class="display-4">New York Brownstone IFC Generator</h1>
            <p class="lead">Create detailed 3D models of classic New York brownstones in Industry Foundation Classes (IFC) format using Python</p>
            <a href="#download" class="btn btn-primary btn-lg mt-3">
                <i class="fas fa-download me-2"></i>Download Scripts
            </a>
        </div>
    </header>

    <!-- Overview Section -->
    <section id="overview" class="section bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h2 class="mb-4">Generate Complete Brownstone Models</h2>
                    <p class="lead">Our Python-based IFC generator creates detailed 3D models of classic New York brownstones, complete with architectural elements, fixtures, and basic MEP systems.</p>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-md-4 text-center">
                    <div class="feature-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3>Architectural Accuracy</h3>
                    <p>Authentic brownstone design with traditional elements like the classic stoop, high-ceilinged parlor floor, and period-appropriate dimensions.</p>
                </div>
                <div class="col-md-4 text-center">
                    <div class="feature-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h3>Customizable</h3>
                    <p>Easily modify dimensions, layout, and features by changing parameters in the Python script to create your ideal brownstone model.</p>
                </div>
                <div class="col-md-4 text-center">
                    <div class="feature-icon">
                        <i class="fas fa-file-export"></i>
                    </div>
                    <h3>BIM Compatible</h3>
                    <p>Generated IFC files can be imported into professional BIM software like Revit, ArchiCAD, and other IFC-compatible tools.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Scripts Section -->
    <section id="scripts" class="section">
        <div class="container">
            <h2 class="text-center mb-5">How It Works</h2>
            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title"><span class="step-number">1</span> Generator Script</h4>
                            <p class="card-text">The main Python script that creates the IFC model of the brownstone building. It uses IfcOpenShell to define the building structure, walls, floors, windows, doors, and fixtures.</p>
                            <div class="code-block">
                                <pre><code>python brownstone-ifc-generator.py</code></pre>
                            </div>
                            <h5>Key Features:</h5>
                            <ul>
                                <li>Creates complete 5-story brownstone (basement + 4 floors)</li>
                                <li>Generates walls, floors, windows, doors</li>
                                <li>Adds stoop, fixtures, and basic MEP elements</li>
                                <li>Produces standard IFC file for BIM compatibility</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title"><span class="step-number">2</span> Viewer Script</h4>
                            <p class="card-text">A companion script that visualizes the generated IFC model using PyVista. Allows for interactive exploration of the 3D brownstone model.</p>
                            <div class="code-block">
                                <pre><code>python brownstone-ifc-viewer.py</code></pre>
                            </div>
                            <h5>Visualization Features:</h5>
                            <ul>
                                <li>Interactive 3D visualization</li>
                                <li>Color-coded building elements</li>
                                <li>Rotation, pan, and zoom controls</li>
                                <li>Element identification</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title"><span class="step-number">3</span> Setup Script</h4>
                            <p class="card-text">A helper script that checks for and installs the necessary dependencies to run the generator and viewer scripts.</p>
                            <div class="code-block">
                                <pre><code>python brownstone-ifc-setup.py</code></pre>
                            </div>
                            <h5>Manages Dependencies:</h5>
                            <ul>
                                <li>IfcOpenShell for IFC file manipulation</li>
                                <li>NumPy for numerical operations</li>
                                <li>PyVista for 3D visualization</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title"><span class="step-number">4</span> Customization</h4>
                            <p class="card-text">The scripts can be easily customized by modifying the parameters at the top of the generator file.</p>
                            <div class="code-block">
                                <pre><code># Global parameters for the brownstone
BUILDING_WIDTH = 40.0  # feet
BUILDING_DEPTH = 80.0  # feet
BASEMENT_HEIGHT = 9.0  # feet
FIRST_FLOOR_HEIGHT = 10.0  # feet
SECOND_FLOOR_HEIGHT = 14.0  # feet
THIRD_FLOOR_HEIGHT = 12.0  # feet
FOURTH_FLOOR_HEIGHT = 12.0  # feet</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 3D Viewer Section -->
    <section id="viewer" class="section bg-light">
        <div class="container">
            <h2 class="text-center mb-5">Interactive 3D Viewer</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto mb-4">
                    <p class="text-center">Upload your generated IFC file to visualize it in the browser:</p>
                    <div class="input-group mb-3">
                        <input type="file" class="form-control" id="ifc-file-input" accept=".ifc">
                        <button class="btn btn-primary" type="button" id="load-ifc-button">Load Model</button>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div id="viewer-container">
                        <div id="loading-message" class="position-absolute top-50 start-50 translate-middle text-center d-none">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p>Loading IFC model...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-lg-8 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Viewer Controls</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul>
                                        <li><strong>Rotate:</strong> Left-click + drag</li>
                                        <li><strong>Pan:</strong> Right-click + drag</li>
                                        <li><strong>Zoom:</strong> Scroll wheel</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul>
                                        <li><strong>Reset View:</strong> <button id="reset-view-button" class="btn btn-sm btn-secondary">Reset</button></li>
                                        <li><strong>Toggle Elements:</strong> <button id="toggle-walls-button" class="btn btn-sm btn-outline-primary">Walls</button> <button id="toggle-floors-button" class="btn btn-sm btn-outline-primary">Floors</button></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Documentation Section -->
    <section id="documentation" class="section">
        <div class="container">
            <h2 class="text-center mb-5">Documentation</h2>
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <div class="accordion" id="documentationAccordion">
                        <!-- Installation -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    Installation Instructions
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#documentationAccordion">
                                <div class="accordion-body">
                                    <ol>
                                        <li>Install Python 3.7 or newer</li>
                                        <li>Download the script package</li>
                                        <li>Run the setup script to install dependencies:
                                            <div class="code-block">
                                                <pre><code>python brownstone-ifc-setup.py</code></pre>
                                            </div>
                                        </li>
                                        <li>Once setup is complete, you can run the generator script</li>
                                    </ol>
                                    <div class="alert alert-info mt-3">
                                        <i class="fas fa-info-circle me-2"></i> The setup script will attempt to install all required dependencies, including IfcOpenShell, NumPy, and PyVista.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Usage -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    Usage Guide
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#documentationAccordion">
                                <div class="accordion-body">
                                    <h5>1. Generate the IFC Model</h5>
                                    <p>Run the generator script to create the brownstone IFC file:</p>
                                    <div class="code-block">
                                        <pre><code>python brownstone-ifc-generator.py</code></pre>
                                    </div>
                                    <p>This will create a file named <code>new_york_brownstone.ifc</code> in the current directory.</p>
                                    
                                    <h5>2. View the Model</h5>
                                    <p>Use the viewer script to visualize the generated model:</p>
                                    <div class="code-block">
                                        <pre><code>python brownstone-ifc-viewer.py</code></pre>
                                    </div>
                                    <p>You can also specify a different IFC file to view:</p>
                                    <div class="code-block">
                                        <pre><code>python brownstone-ifc-viewer.py path/to/your/file.ifc</code></pre>
                                    </div>
                                    
                                    <h5>3. Customize the Model</h5>
                                    <p>Edit the parameters at the top of <code>brownstone-ifc-generator.py</code> to change dimensions, layout, and other features of the brownstone.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Model Details -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    Model Specifications
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#documentationAccordion">
                                <div class="accordion-body">
                                    <h5>Brownstone Structure</h5>
                                    <ul>
                                        <li><strong>Building Footprint:</strong> 40' × 80'</li>
                                        <li><strong>Lot Size:</strong> 50' × 100'</li>
                                        <li><strong>Number of Floors:</strong> 5 (basement + 4 floors)</li>
                                        <li><strong>Total Height:</strong> Approximately 60'</li>
                                        <li><strong>Total Area:</strong> Approximately 16,000 sq ft</li>
                                    </ul>
                                    
                                    <h5>Brownstone Features</h5>
                                    <ul>
                                        <li><strong>Classic Facade:</strong> Traditional brownstone front</li>
                                        <li><strong>Stoop:</strong> Traditional entry staircase</li>
                                        <li><strong>Parlor Floor:</strong> High-ceilinged second floor (14' ceiling height)</li>
                                        <li><strong>Windows:</strong> Traditional sash windows</li>
                                        <li><strong>Layout:</strong> Typical brownstone room organization</li>
                                    </ul>
                                    
                                    <h5>Included Elements</h5>
                                    <ul>
                                        <li>Exterior and interior walls</li>
                                        <li>Floors and roof</li>
                                        <li>Windows and doors</li>
                                        <li>Basic plumbing fixtures</li>
                                        <li>Basic MEP elements</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Troubleshooting -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                    Troubleshooting
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#documentationAccordion">
                                <div class="accordion-body">
                                    <h5>Common Issues and Solutions</h5>
                                    
                                    <div class="alert alert-warning">
                                        <strong>Issue:</strong> ImportError: No module named ifcopenshell<br>
                                        <strong>Solution:</strong> IfcOpenShell can be difficult to install on some platforms. Try installing from the official website or using a pre-built wheel.
                                    </div>
                                    
                                    <div class="alert alert-warning">
                                        <strong>Issue:</strong> Visualization shows no geometry<br>
                                        <strong>Solution:</strong> Verify the IFC file was generated correctly and that PyVista is properly installed with all dependencies.
                                    </div>
                                    
                                    <div class="alert alert-warning">
                                        <strong>Issue:</strong> Memory errors during generation<br>
                                        <strong>Solution:</strong> Reduce the level of detail in the model by modifying the generator script, or run the script on a machine with more RAM.
                                    </div>
                                    
                                    <h5>Getting Help</h5>
                                    <p>If you encounter issues not covered here, check the README file included with the scripts or submit an issue on the project's GitHub repository.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Download Section -->
    <section id="download" class="section bg-primary text-white text-center">
        <div class="container">
            <h2 class="mb-4">Download the Brownstone IFC Generator</h2>
            <p class="lead mb-5">Get started creating your own brownstone models with our Python script package</p>
            <a href="#" class="btn btn-light btn-lg me-2">
                <i class="fas fa-download me-2"></i>Download Scripts (.zip)
            </a>
            <a href="#" class="btn btn-outline-light btn-lg">
                <i class="fab fa-github me-2"></i>View on GitHub
            </a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Brownstone IFC Generator</h5>
                    <p>A Python-based tool for creating detailed 3D models of classic New York brownstones in IFC format.</p>
                </div>
                <div class="col-md-3">
                    <h5>Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#overview" class="text-white">Overview</a></li>
                        <li><a href="#scripts" class="text-white">Scripts</a></li>
                        <li><a href="#viewer" class="text-white">3D Viewer</a></li>
                        <li><a href="#documentation" class="text-white">Documentation</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Resources</h5>
                    <ul class="list-unstyled">
                        <li><a href="https://ifcopenshell.org/" class="text-white" target="_blank">IfcOpenShell</a></li>
                        <li><a href="https://www.pyvista.org/" class="text-white" target="_blank">PyVista</a></li>
                        <li><a href="https://www.buildingsmart.org/standards/bsi-standards/industry-foundation-classes/" class="text-white" target="_blank">IFC Standards</a></li>
                    </ul>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <p>&copy; 2025 Brownstone IFC Generator. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap & Popper JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- 3D Viewer Script -->
    <script>
        // Initialize the IFC viewer
        let scene, camera, renderer, controls;
        let ifcLoader;
        let model;

        // Set up the viewer when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initViewer();

            // Add event listeners for controls
            document.getElementById('load-ifc-button').addEventListener('click', loadIFCFile);
            document.getElementById('reset-view-button').addEventListener('click', resetView);
            document.getElementById('toggle-walls-button').addEventListener('click', toggleWalls);
            document.getElementById('toggle-floors-button').addEventListener('click', toggleFloors);
        });

        // Initialize the Three.js viewer
        function initViewer() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);

            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(30, 20, 30);
            camera.lookAt(0, 10, 0);

            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            const container = document.getElementById('viewer-container');
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Create controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 10, 0);
            controls.update();

            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            // Add directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 30);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Initialize the IFC loader if available
            try {
                ifcLoader = new WebIFC.IFCLoader();
                ifcLoader.ifcManager.setWasmPath('https://unpkg.com/web-ifc@0.0.36/');
            } catch (error) {
                console.error('Error initializing IFC loader:', error);
                showError('Failed to initialize IFC loader. Please check console for details.');
            }

            // Handle window resize
            window.addEventListener('resize', onWindowResize);

            // Start animation loop
            animate();

            // Create a default brownstone model
            createDefaultModel();
        }

        // Create a default brownstone model for display
        function createDefaultModel() {
            // Create a simple brownstone shape
            const baseGeometry = new THREE.BoxGeometry(40, 40, 80);
            const baseMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const baseModel = new THREE.Mesh(baseGeometry, baseMaterial);
            baseModel.position.set(0, 20, 0);
            baseModel.rotation.y = Math.PI / 2;
            
            // Create floors
            for (let i = 0; i < 5; i++) {
                const floorGeometry = new THREE.BoxGeometry(42, 1, 82);
                const floorMaterial = new THREE.MeshStandardMaterial({ color: 0xCCCCCC });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.position.set(0, i * 10, 0);
                floor.rotation.y = Math.PI / 2;
                scene.add(floor);
            }
            
            // Create windows
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 3; j++) {
                    // Front windows
                    const windowGeometry = new THREE.BoxGeometry(1, 6, 3);
                    const windowMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0x87CEEB,
                        transparent: true,
                        opacity: 0.7
                    });
                    const frontWindow = new THREE.Mesh(windowGeometry, windowMaterial);
                    frontWindow.position.set(41, i * 10 + 7, (j-1) * 15);
                    scene.add(frontWindow);
                    
                    // Back windows
                    const backWindow = new THREE.Mesh(windowGeometry, windowMaterial);
                    backWindow.position.set(-41, i * 10 + 7, (j-1) * 15);
                    scene.add(backWindow);
                }
            }
            
            // Create stoop
            const stoopGeometry = new THREE.BoxGeometry(10, 5, 15);
            const stoopMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const stoop = new THREE.Mesh(stoopGeometry, stoopMaterial);
            stoop.position.set(0, 2.5, 47);
            stoop.rotation.y = Math.PI / 2;
            scene.add(stoop);
            
            // Add the base model
            scene.add(baseModel);
            
            // Add a ground
            const groundGeometry = new THREE.PlaneGeometry(150, 150);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x7CFC00,
                side: THREE.DoubleSide
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = Math.PI / 2;
            ground.position.y = -0.5;
            scene.add(ground);
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Handle window resize
        function onWindowResize() {
            const container = document.getElementById('viewer-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // Load an IFC file
        function loadIFCFile() {
            const fileInput = document.getElementById('ifc-file-input');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select an IFC file first.');
                return;
            }

            // Show loading message
            const loadingMessage = document.getElementById('loading-message');
            loadingMessage.classList.remove('d-none');

            // Clear existing model
            if (model) {
                scene.remove(model);
            }

            try {
                // Reset the scene
                while(scene.children.length > 0){ 
                    scene.remove(scene.children[0]); 
                }
                
                // Re-add lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(50, 50, 30);
                scene.add(directionalLight);
                
                // Load the IFC file using the IFC.js loader
                if (ifcLoader) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const arrayBuffer = e.target.result;
                        
                        ifcLoader.parse(arrayBuffer).then(function(ifcModel) {
                            model = ifcModel;
                            scene.add(model);
                            
                            // Center the camera on the model
                            const box = new THREE.Box3().setFromObject(model);
                            const center = box.getCenter(new THREE.Vector3());
                            const size = box.getSize(new THREE.Vector3());
                            
                            controls.target.copy(center);
                            camera.position.set(
                                center.x + size.x * 2,
                                center.y + size.y * 2,
                                center.z + size.z * 2
                            );
                            camera.lookAt(center);
                            controls.update();
                            
                            // Hide loading message
                            loadingMessage.classList.add('d-none');
                        }).catch(function(error) {
                            console.error('Error parsing IFC file:', error);
                            showError('Failed to parse IFC file. Please check if it\'s a valid IFC format.');
                            loadingMessage.classList.add('d-none');
                            
                            // Show default model if parsing fails
                            createDefaultModel();
                        });
                    };
                    reader.readAsArrayBuffer(file);
                } else {
                    showError('IFC loader is not available. Please check if web-ifc-three.js is loaded properly.');
                    loadingMessage.classList.add('d-none');
                    
                    // Show default model if loader not available
                    createDefaultModel();
                }
            } catch (error) {
                console.error('Error loading IFC file:', error);
                showError('An error occurred while loading the IFC file.');
                loadingMessage.classList.add('d-none');
                
                // Show default model if error occurs
                createDefaultModel();
            }
        }

        // Reset the camera view
        function resetView() {
            if (model) {
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                controls.target.copy(center);
                camera.position.set(
                    center.x + size.x * 2,
                    center.y + size.y * 2,
                    center.z + size.z * 2
                );
                camera.lookAt(center);
            } else {
                camera.position.set(30, 20, 30);
                controls.target.set(0, 10, 0);
            }
            
            controls.update();
        }

        // Toggle visibility of walls
        function toggleWalls() {
            if (!model) return;
            
            const button = document.getElementById('toggle-walls-button');
            const isActive = button.classList.contains('btn-primary');
            
            if (isActive) {
                button.classList.remove('btn-primary');
                button.classList.add('btn-outline-primary');
            } else {
                button.classList.remove('btn-outline-primary');
                button.classList.add('btn-primary');
            }
            
            // Toggle visibility of wall elements in the IFC model
            model.traverse(function(child) {
                if (child.userData && child.userData.type === 'IfcWall') {
                    child.visible = !isActive;
                }
            });
        }

        // Toggle visibility of floors
        function toggleFloors() {
            if (!model) return;
            
            const button = document.getElementById('toggle-floors-button');
            const isActive = button.classList.contains('btn-primary');
            
            if (isActive) {
                button.classList.remove('btn-primary');
                button.classList.add('btn-outline-primary');
            } else {
                button.classList.remove('btn-outline-primary');
                button.classList.add('btn-primary');
            }
            
            // Toggle visibility of floor elements in the IFC model
            model.traverse(function(child) {
                if (child.userData && child.userData.type === 'IfcSlab') {
                    child.visible = !isActive;
                }
            });
        }

        // Show error message to user
        function showError(message) {
            // Create an error alert
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger alert-dismissible fade show';
            alertDiv.role = 'alert';
            alertDiv.innerHTML = `
                <strong>Error:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            // Add to the viewer container
            const container = document.getElementById('viewer-container');
            container.appendChild(alertDiv);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode === container) {
                    container.removeChild(alertDiv);
                }
            }, 5000);
        }
        
        // Simplified IFC model using Three.js when actual IFC models aren't available
        function createSimplifiedIFCModel() {
            // Create an object to hold the model
            const ifcModel = new THREE.Group();
            
            // Materials
            const wallMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0xCCCCCC });
            const windowMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x87CEEB,
                transparent: true,
                opacity: 0.7
            });
            const doorMaterial = new THREE.MeshStandardMaterial({ color: 0x6B3E26 });
            
            // Building dimensions
            const width = 40;
            const depth = 80;
            const floorHeight = 10;
            const numFloors = 5;
            
            // Create floors
            for (let i = 0; i < numFloors; i++) {
                const floorGeometry = new THREE.BoxGeometry(width, 1, depth);
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.position.set(0, i * floorHeight, 0);
                floor.userData = { type: 'IfcSlab' };
                ifcModel.add(floor);
            }
            
            // Create exterior walls
            const wallThickness = 1;
            const wallHeight = floorHeight - 1;
            
            for (let i = 0; i < numFloors; i++) {
                // Front wall
                const frontWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);
                const frontWall = new THREE.Mesh(frontWallGeometry, wallMaterial);
                frontWall.position.set(0, i * floorHeight + wallHeight/2 + 0.5, depth/2 - wallThickness/2);
                frontWall.userData = { type: 'IfcWall' };
                ifcModel.add(frontWall);
                
                // Back wall
                const backWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);
                const backWall = new THREE.Mesh(backWallGeometry, wallMaterial);
                backWall.position.set(0, i * floorHeight + wallHeight/2 + 0.5, -depth/2 + wallThickness/2);
                backWall.userData = { type: 'IfcWall' };
                ifcModel.add(backWall);
                
                // Left wall
                const leftWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);
                const leftWall = new THREE.Mesh(leftWallGeometry, wallMaterial);
                leftWall.position.set(-width/2 + wallThickness/2, i * floorHeight + wallHeight/2 + 0.5, 0);
                leftWall.userData = { type: 'IfcWall' };
                ifcModel.add(leftWall);
                
                // Right wall
                const rightWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);
                const rightWall = new THREE.Mesh(rightWallGeometry, wallMaterial);
                rightWall.position.set(width/2 - wallThickness/2, i * floorHeight + wallHeight/2 + 0.5, 0);
                rightWall.userData = { type: 'IfcWall' };
                ifcModel.add(rightWall);
            }
            
            // Add windows to front wall
            const windowWidth = 4;
            const windowHeight = 6;
            const windowsPerFloor = 3;
            
            for (let i = 1; i < numFloors; i++) {  // Skip basement floor
                for (let j = 0; j < windowsPerFloor; j++) {
                    const windowGeometry = new THREE.BoxGeometry(windowWidth, windowHeight, wallThickness * 1.1);
                    const window = new THREE.Mesh(windowGeometry, windowMaterial);
                    
                    // Position along front wall
                    const xPos = -width/2 + (j+1) * width/(windowsPerFloor+1);
                    window.position.set(
                        xPos, 
                        i * floorHeight + wallHeight/2 + 0.5, 
                        depth/2 - wallThickness/2
                    );
                    window.userData = { type: 'IfcWindow' };
                    ifcModel.add(window);
                }
            }
            
            // Add front door
            const doorWidth = 5;
            const doorHeight = 8;
            const doorGeometry = new THREE.BoxGeometry(doorWidth, doorHeight, wallThickness * 1.1);
            const door = new THREE.Mesh(doorGeometry, doorMaterial);
            door.position.set(0, floorHeight + doorHeight/2 + 0.5, depth/2 - wallThickness/2);
            door.userData = { type: 'IfcDoor' };
            ifcModel.add(door);
            
            // Add stoop
            const stoopWidth = 12;
            const stoopDepth = 8;
            const stoopHeight = 5;
            const stoopGeometry = new THREE.BoxGeometry(stoopWidth, stoopHeight, stoopDepth);
            const stoop = new THREE.Mesh(stoopGeometry, wallMaterial);
            stoop.position.set(0, stoopHeight/2, depth/2 + stoopDepth/2);
            stoop.userData = { type: 'IfcStair' };
            ifcModel.add(stoop);
            
            return ifcModel;
        }
    </script>
</body>
</html>